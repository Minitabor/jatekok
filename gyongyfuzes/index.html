<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gy√∂ngyf≈±z√©s Kih√≠v√°s</title>
    <!-- Tailwind CSS a gyors √©s sz√©p st√≠lusoz√°shoz -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* A gy√∂ngy√∂k vizu√°lis alapja */
        .bead-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.25rem;
            font-weight: bold;
            color: white;
            /* Eredeti √°rny√©k helyett 3D-s/dombor√∫ hat√°s */
            box-shadow: 
                inset 0 0 10px rgba(0, 0, 0, 0.4), /* Bels≈ë √°rny√©k a kiemel√©shez */
                0 6px 10px -3px rgba(0, 0, 0, 0.3); /* K√ºls≈ë √°rny√©k a lebeg√©shez */
            transition: transform 0.1s ease, box-shadow 0.1s ease;
            margin: 0 1px;
            border: 2px solid rgba(255, 255, 255, 0.5); /* F√©nyes keret */
        }
        /* Piros gy√∂ngy - 3D hat√°ssal */
        .bead-P {
            background-color: #d83b3b; /* kicsit s√∂t√©tebb alap */
            /* Sug√°rir√°ny√∫ sz√≠n√°tmenet a f√©nyhat√°s√©rt: vil√°gosabb pont (25% 25%) fel√ºl */
            background-image: radial-gradient(circle at 25% 25%, #ff7777, #d83b3b 60%, #a02222);
        }
        /* K√©k gy√∂ngy - 3D hat√°ssal */
        .bead-K {
            background-color: #2c6eb8; /* kicsit s√∂t√©tebb alap */
            background-image: radial-gradient(circle at 25% 25%, #6aaaff, #2c6eb8 60%, #1a4d8c);
        }
        
        /* --- GOMB ST√çLUSOK FRISS√çT√âSE --- */
        
        /* Gombok √©s k√°rty√°k √°ltal√°nos st√≠lusa */
        .custom-button {
            transition: all 0.15s ease-in-out;
            transform: translateY(0);
            border-radius: 0.5rem; /* Sarok lekerek√≠t√©s biztos√≠t√°sa */
        }
        .custom-button:hover {
            transform: translateY(-2px); /* Enyhe megemelked√©s */
            box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.2), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
        }
        .custom-button:active {
            transform: translateY(1px); /* Lenyomott hat√°s */
            box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.2); /* Bels≈ë √°rny√©k a nyomott √©rz√©s√©rt */
        }

        /* Sz√≠nes gombok (Kih√≠v√°s v√°laszt√≥ √©s Add gombok) extra m√©lys√©ggel */
        .colored-button {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
        }
        
        /* Sz√≠n√°tmenetek az ADD gombokhoz (hasonl√≥an a gy√∂ngy√∂kh√∂z, de visszafogottabban) */
        .add-button-P {
            background-image: linear-gradient(to bottom, #ef4444, #b91c1c); /* Red-500-t√≥l Red-700-ig */
        }
        .add-button-P:hover {
            background-image: linear-gradient(to bottom, #f87171, #ef4444); /* Vil√°gosabb hoveren */
        }
        
        .add-button-K {
            background-image: linear-gradient(to bottom, #3b82f6, #1d4ed8); /* Blue-500-t√≥l Blue-700-ig */
        }
        .add-button-K:hover {
            background-image: linear-gradient(to bottom, #60a5fa, #3b82f6); /* Vil√°gosabb hoveren */
        }

        /* √ârt√©kel√©s gomb (f≈ë CTA) */
        .evaluate-cta {
            background-image: linear-gradient(to bottom right, #6366f1, #4f46e5); /* Indigo sz√≠n√°tmenet */
        }
        .evaluate-cta:hover {
            background-image: linear-gradient(to bottom right, #818cf8, #6366f1);
        }
        .evaluate-cta:disabled {
            background-image: none;
            box-shadow: none;
            transform: none;
        }

        /* T√∂rl√©s gomb (semleges/m√°sodlagos) */
        .remove-button {
            box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.06);
            border: 1px solid #d1d5db; /* gray-300 */
        }
        .remove-button:hover {
            background-color: #e5e7eb; /* gray-200 */
            transform: translateY(-1px);
        }
        .remove-button:active {
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        /* Kisebb gy√∂ngyikon a gombokban (inline st√≠lussal is be√°ll√≠tva, ez a fallback) */
        .button-bead-icon {
            width: 30px; 
            height: 30px; 
            font-size: 1rem; 
            margin: 0;
            /* A gomb ikonjainak k√ºl√∂nleges √°rny√©kol√°sa, hogy ne legyen t√∫l hangs√∫lyos */
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.3); 
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* Gy≈±r≈± st√≠lusok a kih√≠v√°sok kiv√°laszt√°s√°n√°l */
        /* Ezeket friss√≠tem, hogy a ring jobban illeszkedjen a gomb st√≠lus√°hoz */
        .ring-green-300 { --tw-ring-color: #bbf7d0; } /* light green */
        .ring-purple-300 { --tw-ring-color: #e9d5ff; } /* light purple */
        .ring-orange-300 { --tw-ring-color: #fed7aa; } /* light orange */
        
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-start justify-center p-4 sm:p-8 font-sans">
    <div id="main" style="display:none" aria-hidden="true">
    <!-- F≈ë kont√©ner: space-y-8 helyett space-y-6 a sz≈±kebb t√©rk√∂z√∂k√©rt -->
    <div id="app" class="w-full max-w-4xl bg-white p-6 sm:p-8 rounded-xl shadow-2xl space-y-6">
        <header class="text-center border-b pb-4">
            <h1 class="text-3xl sm:text-4xl font-extrabold text-gray-800 flex items-center justify-center gap-3">
                Gy√∂ngyf≈±z√©s Kih√≠v√°s
                <!-- √öj Szab√°lyok gomb - A be√°ll√≠tott custom-button st√≠lust haszn√°lja -->
                <button onclick="showRules()" class="ml-4 py-1 px-3 text-sm font-semibold rounded-full text-indigo-700 bg-indigo-100 hover:bg-indigo-200 custom-button shadow-md">
                    Szab√°lyok
                </button>
            </h1>
            <!-- Elt√°vol√≠tott bevezet≈ë mondat (a felhaszn√°l√≥ k√©r√©se alapj√°n) -->
        </header>

        <!-- 1. Kih√≠v√°s kiv√°laszt√°sa -->
        <section class="bg-blue-50 p-5 rounded-lg border-2 border-blue-200 shadow-inner">
            <h2 class="text-xl font-semibold text-blue-800 mb-4">1. V√°laszd ki a kih√≠v√°st</h2>
            <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4">
                <!-- Challenge gombok: Hozz√°adtam a colored-button oszt√°lyt az extra m√©lys√©g√©rt -->
                <button onclick="setChallenge('wonderful')"
                        class="challenge-button colored-button flex-1 py-3 px-4 rounded-lg text-lg font-medium custom-button transition duration-150 ease-in-out bg-green-500 text-white hover:bg-green-600 shadow-xl">
                    Csod√°latos L√°nc (P√°rok)
                </button>
                <button onclick="setChallenge('fascinating')"
                        class="challenge-button colored-button flex-1 py-3 px-4 rounded-lg text-lg font-medium custom-button transition duration-150 ease-in-out bg-purple-500 text-white hover:bg-purple-600 shadow-xl">
                    Leny≈±g√∂z≈ë L√°nc (H√°rmasok)
                </button>
                <button onclick="setChallenge('fantastic')"
                        class="challenge-button colored-button flex-1 py-3 px-4 rounded-lg text-lg font-medium custom-button transition duration-150 ease-in-out bg-orange-500 text-white hover:bg-orange-600 shadow-xl">
                    Fantasztikus L√°nc (N√©gyesek)
                </button>
            </div>
            <p id="challenge-status" class="mt-4 text-center font-bold text-lg"></p>
        </section>

        <!-- 2. L√°nc √©p√≠t√©se -->
        <section class="space-y-4" id="bead-builder-section">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">2. √âp√≠tsd meg a l√°ncot</h2>

            <!-- L√°nc Vizu√°lis Megjelen√≠t√©se -->
            <div id="bead-chain-display" class="min-h-[60px] p-3 bg-gray-50 border border-gray-200 rounded-lg flex flex-wrap items-center justify-center overflow-x-auto shadow-inner">
                <p class="text-gray-400 italic" id="empty-message">Kezdd el hozz√°adni a gy√∂ngy√∂ket a gombokkal!</p>
            </div>

            <!-- KOMBIN√ÅLT AKCI√ìGOMBOK -->
            <div class="pt-4 grid grid-cols-2 sm:grid-cols-4 gap-3">
                
                <!-- 1. Piros hozz√°ad√°sa - Sz√≠n√°tmenetes st√≠lussal -->
                <button onclick="addBead('P')" class="py-2 px-3 rounded-md text-sm sm:text-base font-bold text-white colored-button custom-button shadow-lg flex items-center justify-center space-x-1 add-button-P">
                    <!-- Kisebb gy√∂ngy ikon a gombban -->
                    <span class="bead-icon bead-P button-bead-icon" style="width: 30px; height: 30px; font-size: 1rem; margin: 0;">P</span> Piros
                </button>

                <!-- 2. K√©k hozz√°ad√°sa - Sz√≠n√°tmenetes st√≠lussal -->
                <button onclick="addBead('K')" class="py-2 px-3 rounded-md text-sm sm:text-base font-bold text-white colored-button custom-button shadow-lg flex items-center justify-center space-x-1 add-button-K">
                    <!-- Kisebb gy√∂ngy ikon a gombban -->
                    <span class="bead-icon bead-K button-bead-icon" style="width: 30px; height: 30px; font-size: 1rem; margin: 0;">K</span> K√©k
                </button>
                
                <!-- 3. Utols√≥ T√∂rl√©se - M√°sodlagos st√≠lussal -->
                <button onclick="removeLastBead()" class="py-2 px-3 rounded-md text-sm sm:text-base font-bold text-gray-700 bg-gray-200 hover:bg-gray-300 custom-button shadow-md remove-button">
                    T√∂rl√©s
                </button>

                <!-- 4. √ârt√©kel√©s (f≈ë CTA) - Sz√≠n√°tmenetes st√≠lussal -->
                <button onclick="evaluateChain()" id="evaluate-button" disabled
                        class="col-span-2 sm:col-span-1 py-2 px-3 rounded-md text-sm sm:text-base font-extrabold text-white custom-button shadow-xl evaluate-cta disabled:bg-gray-400 disabled:shadow-none disabled:transform-none transition duration-150 ease-in-out">
                    √ârt√©kel√©s
                </button>
            </div>
        </section>

        <!-- 3. √ârt√©kel√©s eredm√©nye -->
        <section id="evaluation-result-section" style="display: none;">
            <div id="result-message" class="p-5 rounded-lg border-l-4 text-gray-700 font-medium">
                <!-- Az eredm√©ny itt jelenik meg -->
            </div>
        </section>

    </div>
    </div>

    <script>
        /* ---------- PASSWORD PROTECTION (client-side, hash-based) ---------- */
        // IMPORTANT: Replace the value of STORED_HASH with the SHA-256 hex hash of your chosen password.
        // To generate a hash for your password, open the page in the browser, open DevTools Console and run:
        //   generateHash('your-password').then(console.log)
        // Then copy the printed hex value here (replace 'CHANGE_ME') and reload the page.
        const STORED_HASH = 'fb6f98b8e4f9046c70f73a75224c9713867dda14336a7cc28d2f368d7390614b';
        
        // Limit of attempts before blocking interaction (client-side only)
        const MAX_ATTEMPTS = 5;

        // Utility: compute SHA-256 hex of a string
        async function sha256Hex(str) {
            const enc = new TextEncoder();
            const data = enc.encode(str);
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        // Helper exposed for quick hash generation in console:
        // generateHash('mypassword').then(console.log)
        // window.generateHash = sha256Hex;

        // Create a full-page overlay that blocks access until correct password is entered
        function createLockOverlay() {
            const overlay = document.createElement('div');
            overlay.id = 'pw-overlay';
            Object.assign(overlay.style, {
                position: 'fixed',
                inset: '0',
                background: 'rgba(0,0,0,0.75)',
                color: '#fff',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                zIndex: '9999',
                padding: '20px',
                textAlign: 'center'
            });

            const box = document.createElement('div');
            Object.assign(box.style, {
                background: '#111827',
                padding: '24px',
                borderRadius: '12px',
                maxWidth: '480px',
                width: '100%',
                boxShadow: '0 10px 30px rgba(0,0,0,0.5)'
            });

            box.innerHTML = `
                <h2 style="margin:0 0 8px;font-size:20px;font-weight:700;">Jelsz√≥ v√©delem</h2>
                <p style="margin:0 0 12px;color:#d1d5db;">Add meg a jelsz√≥t a tartalom megtekint√©s√©hez.</p>
                <div style="display:flex;gap:8px;justify-content:center;">
                    <input id="pw-input" type="password" placeholder="Jelsz√≥" style="flex:1;padding:10px;border-radius:8px;border:1px solid #374151;background:#0b1220;color:#fff;" />
                    <button id="pw-submit" style="padding:10px 14px;border-radius:8px;background:#3b82f6;border:none;color:#fff;font-weight:600;cursor:pointer;">Bel√©p√©s</button>
                </div>
                <p id="pw-msg" style="color:#fca5a5;margin-top:10px;min-height:18px;font-size:13px;"></p>
            `;

            overlay.appendChild(box);
            document.body.appendChild(overlay);

            return overlay;
        }

        async function authenticate() {
            const main = document.getElementById('main');

            // If STORED_HASH hasn't been set by the developer, block with an instruction
            if (!STORED_HASH || STORED_HASH === 'CHANGE_ME') {
                const overlay = createLockOverlay();
                const msg = overlay.querySelector('#pw-msg');
                msg.textContent = 'A STORED_HASH nincs be√°ll√≠tva a forr√°sban. Nyisd meg a DevTools konzolt, futtasd: generateHash("a-te-jelszavad").then(console.log) √©s helyezd be a kapott hex √©rt√©ket a STORED_HASH v√°ltoz√≥ba a f√°jlban.';
                return; // no further action until developer sets the hash
            }

            const overlay = createLockOverlay();
            const input = overlay.querySelector('#pw-input');
            const submit = overlay.querySelector('#pw-submit');
            const msg = overlay.querySelector('#pw-msg');

            // keep main hidden/inert while locked
            if (main) {
                main.style.display = 'none';
                main.setAttribute('aria-hidden', 'true');
            }

            let attempts = 0;
            function lockOut() {
                msg.textContent = 'T√∫l sok sikertelen pr√≥b√°lkoz√°s. A hozz√°f√©r√©s ideiglenesen letiltva.';
                input.disabled = true;
                submit.disabled = true;
            }

            async function tryPassword() {
                const value = input.value ?? '';
                if (!value) {
                    msg.textContent = 'Adj meg egy jelsz√≥t.';
                    return;
                }
                attempts++;
                submit.disabled = true;
                msg.textContent = 'Ellen≈ërz√©s...';

                try {
                    const h = await sha256Hex(value);
                    if (h === STORED_HASH) {
                        // Success: remove overlay, reveal content and start the game
                        overlay.remove();
                        if (main) {
                            main.style.display = ''; // restore original display
                            main.removeAttribute('aria-hidden');
                        }
                        return;
                    } else {
                        msg.textContent = `Hib√°s jelsz√≥. Pr√≥b√°lkoz√°sok: ${attempts}/${MAX_ATTEMPTS}`;
                    }
                } catch (err) {
                    console.error(err);
                    msg.textContent = 'Hiba t√∂rt√©nt a jelsz√≥ ellen≈ërz√©se k√∂zben.';
                } finally {
                    submit.disabled = false;
                    if (attempts >= MAX_ATTEMPTS) lockOut();
                }
            }

            submit.addEventListener('click', tryPassword);
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') tryPassword();
            });

            // Focus input automatically
            input.focus();
        }
        /* ---------- end password protection ---------- */
 
        // Glob√°lis √°llapotv√°ltoz√≥k
        let currentChain = []; // A l√°nc gy√∂ngyei (pl. ['P', 'K', 'K'])
        let challengeType = null; // 'wonderful', 'fascinating' vagy 'fantastic'

        // DOM elemek
        const challengeStatusEl = document.getElementById('challenge-status');
        const beadChainDisplayEl = document.getElementById('bead-chain-display');
        const emptyMessageEl = document.getElementById('empty-message');
        const evaluationResultSectionEl = document.getElementById('evaluation-result-section');
        const resultMessageEl = document.getElementById('result-message');
        const evaluateButtonEl = document.getElementById('evaluate-button');
        const challengeButtons = document.querySelectorAll('.challenge-button');

        /**
         * Be√°ll√≠tja a kiv√°lasztott kih√≠v√°s t√≠pus√°t.
         * @param {string} type - 'wonderful', 'fascinating' vagy 'fantastic'.
         */
        function setChallenge(type) {
            challengeType = type;
            currentChain = []; // √öj kih√≠v√°s eset√©n t√∂r√∂lj√ºk a l√°ncot
            updateUI();
            
            // UI friss√≠t√©se (Egyszer≈±s√≠tett sz√∂veg: nincs ism√©tl≈ëd≈ë gy√∂ngyp√°ros/gy√∂ngyh√°rmas/gy√∂ngyn√©gyes)
            // Minden gombr√≥l elt√°vol√≠tjuk a kiemel√©st
            challengeButtons.forEach(btn => btn.classList.remove('ring-4', 'ring-offset-2', 'ring-green-300', 'ring-purple-300', 'ring-orange-300'));
            
            let statusText;
            let ringColorClass;

            if (type === 'wonderful') {
                statusText = "Kiv√°lasztva: Csod√°latos L√°nc (nincs ism√©tl≈ëd≈ë gy√∂ngyp√°ros).";
                ringColorClass = 'ring-green-300';
            } else if (type === 'fascinating') {
                statusText = "Kiv√°lasztva: Leny≈±g√∂z≈ë L√°nc (nincs ism√©tl≈ëd≈ë gy√∂ngyh√°rmas).";
                ringColorClass = 'ring-purple-300';
            } else if (type === 'fantastic') {
                statusText = "Kiv√°lasztva: Fantasztikus L√°nc (nincs ism√©tl≈ëd≈ë gy√∂ngyn√©gyes).";
                ringColorClass = 'ring-orange-300';
            }

            challengeStatusEl.textContent = statusText;
            
            // Megkeress√ºk a gombot, amelyik elind√≠totta az esem√©nyt, √©s alkalmazzuk a gy≈±r≈±t
            const targetButton = Array.from(challengeButtons).find(btn => btn.getAttribute('onclick').includes(`'${type}'`));
            if (targetButton) {
                targetButton.classList.add('ring-4', 'ring-offset-2', ringColorClass);
            }
            
            evaluationResultSectionEl.style.display = 'none';
        }

        /**
         * Gy√∂ngy hozz√°ad√°sa a l√°nchoz.
         * @param {string} bead - 'P' vagy 'K'.
         */
        function addBead(bead) {
            if (!challengeType) {
                showModal('Figyelem!', "El≈ësz√∂r v√°laszd ki, hogy Csod√°latos, Leny≈±g√∂z≈ë vagy Fantasztikus l√°ncot szeretn√©l √©p√≠teni!", 'text-yellow-600');
                return;
            }
            currentChain.push(bead);
            updateUI();
        }

        /**
         * Az utols√≥ gy√∂ngy elt√°vol√≠t√°sa a l√°ncb√≥l.
         */
        function removeLastBead() {
            currentChain.pop();
            updateUI();
        }

        /**
         * Friss√≠ti a l√°nc vizu√°lis megjelen√≠t√©s√©t √©s az √ârt√©kel√©s gomb √°llapot√°t.
         */
        function updateUI() {
            // Gy√∂ngy√∂k friss√≠t√©se
            beadChainDisplayEl.innerHTML = '';
            if (currentChain.length === 0) {
                emptyMessageEl.style.display = 'block';
                beadChainDisplayEl.appendChild(emptyMessageEl);
            } else {
                emptyMessageEl.style.display = 'none';
                currentChain.forEach((bead) => {
                    const beadEl = document.createElement('div');
                    beadEl.className = `bead-icon bead-${bead}`;
                    beadEl.textContent = bead;
                    beadChainDisplayEl.appendChild(beadEl);
                });
            }
            
            // Gomb √©s szekci√≥k √°llapot√°nak friss√≠t√©se
            let requiredLength = 0;
            if (challengeType === 'wonderful') requiredLength = 2;
            else if (challengeType === 'fascinating') requiredLength = 3;
            else if (challengeType === 'fantastic') requiredLength = 4; // Fantasztikus l√°nc min. 4 gy√∂ngy
            
            // Az "√ârt√©kel√©s" gomb tilt√°sa/enged√©lyez√©se
            evaluateButtonEl.disabled = currentChain.length < requiredLength;
            evaluationResultSectionEl.style.display = 'none';
        }

        /**
         * Ki√©rt√©keli a l√°ncot a kiv√°lasztott kih√≠v√°s alapj√°n.
         */
        function evaluateChain() {
            if (!challengeType || currentChain.length === 0) {
                showModal('Figyelem!', "V√°laszd ki a kih√≠v√°st √©s √©p√≠ts l√°ncot a ki√©rt√©kel√©shez.", 'text-yellow-600');
                return;
            }

            const chainString = currentChain.join('');
            
            let isSuccessful = false;
            let resultDetails = '';
            
            if (challengeType === 'wonderful') {
                // Csod√°latos L√°nc (P√°rok - hossza 2)
                const evaluation = checkChain(chainString, 2, 'Csod√°latos', 'gy√∂ngyp√°rost', 'gy√∂ngyp√°ros', 'PK √©s KP k√ºl√∂nb√∂z≈ë');
                isSuccessful = evaluation.isSuccessful;
                resultDetails = evaluation.message;
            } else if (challengeType === 'fascinating') {
                // Leny≈±g√∂z≈ë L√°nc (H√°rmasok - hossza 3)
                const evaluation = checkChain(chainString, 3, 'Leny≈±g√∂z≈ë', 'gy√∂ngyh√°rmast', 'gy√∂ngyh√°rmas', 'a gy√∂ngy√∂k sorrendje is sz√°m√≠t');
                isSuccessful = evaluation.isSuccessful;
                resultDetails = evaluation.message;
            } else if (challengeType === 'fantastic') {
                // Fantasztikus L√°nc (N√©gyesek - hossza 4)
                const evaluation = checkChain(chainString, 4, 'Fantasztikus', 'gy√∂ngyn√©gyest', 'gy√∂ngyn√©gyes', 'a gy√∂ngy√∂k sorrendje is sz√°m√≠t, pl. PPKK ism√©tl≈ëd√©se tilos');
                isSuccessful = evaluation.isSuccessful;
                resultDetails = evaluation.message;
            }

            displayResult(isSuccessful, resultDetails);
        }

        /**
         * √Åltal√°nos l√°nc ellen≈ërz≈ë logika.
         * @param {string} chain - A teljes l√°nc stringk√©nt.
         * @param {number} segmentLength - A vizsg√°lt szegmens hossza (2 p√°r, 3 h√°rmas, 4 n√©gyes).
         * @param {string} challengeName - A kih√≠v√°s neve.
         * @param {string} segmentNameAccusative - A szegmens neve (p√°rost/h√°rmast/n√©gyest) - T√°rgyeset (t).
         * @param {string} segmentNameNominative - A szegmens neve (p√°ros/h√°rmas/n√©gyes) - Alanyeset (t n√©lk√ºl).
         * @param {string} ruleNote - A szab√°ly kieg√©sz√≠t≈ë megjegyz√©se.
         * @returns {{isSuccessful: boolean, message: string}}
         */
        function checkChain(chain, segmentLength, challengeName, segmentNameAccusative, segmentNameNominative, ruleNote) {
            if (chain.length < segmentLength) {
                return { isSuccessful: false, message: `A l√°nc t√∫l r√∂vid a ki√©rt√©kel√©shez. Minimum ${segmentLength} gy√∂ngy sz√ºks√©ges.` };
            }

            const segments = {}; // P√°rosok/h√°rmasok/n√©gyesek gyakoris√°g√°nak t√°rol√°sa
            let firstDuplicate = null;
            
            // V√©gigmegy√ºnk a l√°ncon, √©s kiv√°lasztjuk az √∂sszes szomsz√©dos szegmenst
            for (let i = 0; i <= chain.length - segmentLength; i++) {
                const segment = chain.substring(i, i + segmentLength);
                segments[segment] = (segments[segment] || 0) + 1;
                
                // Ha ism√©tl≈ëd√©s van, mentj√ºk √©s le√°llunk
                if (segments[segment] > 1 && !firstDuplicate) {
                    firstDuplicate = { segment, index: i };
                }
            }

            if (firstDuplicate) {
                // SIKERTELEN 
                const segment = firstDuplicate.segment;
                
                // Megkeress√ºk az ELS≈ê ism√©tl≈ëd≈ë p√©ld√°t a hiba bemutat√°s√°hoz
                const firstIndex = chain.indexOf(segment);
                
                // A m√°sodik el≈ëfordul√°s (ez az i index, ahol a duplik√°tumot tal√°ltuk)
                const secondIndex = firstDuplicate.index; 

                // Kiemelj√ºk az el≈ëfordul√°sokat a l√°ncban 
                const highlightedChain = Array.from(chain).map((char, idx) => {
                    let text = char;
                    const isHighlighted = (idx >= firstIndex && idx < firstIndex + segmentLength) || 
                                          (idx >= secondIndex && idx < secondIndex + segmentLength);
                    
                    if (isHighlighted) {
                        text = `<span class="font-extrabold text-red-600">${char}</span>`;
                    }
                    return text;
                }).join('');


                const message = `
                    <p class="mb-2"><strong>Sajn√°lom, a l√°ncod NEM ${challengeName}!</strong></p>
                    <p>Ennek oka, hogy a <strong>${segment}</strong> ${segmentNameNominative} ism√©tl≈ëdik a l√°ncban.</p>
                    <p class="text-sm italic text-gray-500">(${ruleNote}.)</p>
                    <p class="mt-3 p-3 bg-red-100 rounded-lg text-lg">
                        L√°nc: ${highlightedChain}
                    </p>
                `;
                
                return { isSuccessful: false, message: message };
                
            } else {
                // SIKERES
                const message = `
                    <p class="text-2xl font-bold mb-2">üéâ Gratul√°lok! A l√°ncod ${challengeName.toUpperCase()}! üéâ</p>
                    <p>Nem tal√°ltam k√©t azonos ${segmentNameAccusative} a l√°ncban.</p>
                    <p class="mt-2 text-sm italic text-gray-500">L√°ncod hossza: ${chain.length} gy√∂ngy.</p>
                `;
                return { isSuccessful: true, message: message };
            }
        }

        /**
         * Az eredm√©nyt jelen√≠ti meg a felhaszn√°l√≥nak.
         * @param {boolean} success - Siker√ºlt-e a kih√≠v√°s.
         * @param {string} message - A ki√≠rand√≥ √ºzenet.
         */
        function displayResult(success, message) {
            evaluationResultSectionEl.style.display = 'block';
            
            // √öJ: G√∂rgess√ºk az eredm√©ny szekci√≥t a l√°t√≥mez≈ëbe.
            evaluationResultSectionEl.scrollIntoView({ behavior: 'smooth', block: 'start' });

            resultMessageEl.innerHTML = message;

            if (success) {
                resultMessageEl.className = 'p-5 rounded-lg border-l-4 border-green-500 bg-green-100 text-green-800 font-medium';
            } else {
                resultMessageEl.className = 'p-5 rounded-lg border-l-4 border-red-500 bg-red-100 text-red-800 font-medium';
            }
        }
        
        /**
         * Megjelen√≠ti a j√°t√©kszab√°lyokat egy mod√°lis ablakban.
         */
        function showRules() {
            const rulesContent = `
                <p class="mb-3">Ez a j√°t√©k a gy√∂ngyl√°nc ism√©tl≈ëd≈ë mint√°it vizsg√°lja. A c√©l: min√©l hosszabb, a kiv√°lasztott szab√°lynak megfelel≈ë l√°ncot √©p√≠teni!</p>
                <div class="p-3 my-2 bg-green-50 rounded-lg border border-green-200">
                    <strong class="text-green-700">Csod√°latos L√°nc (P√°rok):</strong>
                    <p class="text-sm mt-1">NINCS k√©t azonos gy√∂ngyp√°ros ism√©tl≈ëd√©s a l√°ncban. (Minim√°lis hossz: 2 gy√∂ngy. Pl. PK ism√©tl≈ëd√©se tilos)</p>
                </div>
                <div class="p-3 my-2 bg-purple-50 rounded-lg border border-purple-200">
                    <strong class="text-purple-700">Leny≈±g√∂z≈ë L√°nc (H√°rmasok):</strong>
                    <p class="text-sm mt-1">NINCS k√©t azonos gy√∂ngyh√°rmas ism√©tl≈ëd√©s a l√°ncban. (Minim√°lis hossz: 3 gy√∂ngy. Pl. KPK ism√©tl≈ëd√©se tilos)</p>
                </div>
                <!-- √öJ SZAB√ÅLY: Fantasztikus L√°nc -->
                <div class="p-3 my-2 bg-orange-50 rounded-lg border border-orange-200">
                    <strong class="text-orange-700">Fantasztikus L√°nc (N√©gyesek):</strong>
                    <p class="text-sm mt-1">NINCS k√©t azonos gy√∂ngyn√©gyes ism√©tl≈ëd√©s a l√°ncban. (Minim√°lis hossz: 4 gy√∂ngy. Pl. PPKK ism√©tl≈ëd√©se tilos)</p>
                </div>
            `;
            showModal('J√°t√©kszab√°lyok √©s Haszn√°lat', rulesContent, 'text-indigo-600');
        }

        /**
         * Egyedi mod√°lis/√ºzenet ablak.
         * @param {string} title - A mod√°lis ablak c√≠me.
         * @param {string} msg - A megjelen√≠tend≈ë tartalom (HTML is lehet).
         * @param {string} titleColor - Tailwind oszt√°ly a c√≠m sz√≠n√©hez.
         */
        function showModal(title, msg, titleColor = 'text-red-600') {
            const tempEl = document.createElement('div');
            tempEl.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50';
            tempEl.innerHTML = `
                <div class="bg-white p-6 rounded-xl shadow-2xl max-w-lg w-full space-y-4 transform transition-all duration-300 scale-100 opacity-100">
                    <h3 class="text-xl font-bold ${titleColor}">${title}</h3>
                    <div class="text-gray-700 leading-relaxed">${msg}</div>
                    <button onclick="this.parentElement.parentElement.remove()" 
                        class="w-full py-2 bg-indigo-600 text-white font-semibold rounded-md hover:bg-indigo-700 custom-button">
                        Bez√°r
                    </button>
                </div>
            `;
            document.body.appendChild(tempEl);
        }

        // Kezdeti √°llapot be√°ll√≠t√°sa
        updateUI();
        window.onload = authenticate;
    </script>

</body>
</html>
