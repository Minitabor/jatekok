<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kincskeres≈ë J√°t√©k</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        /* A r√°cspontok vizu√°lis megjelen√≠t√©s√©re szolg√°l√≥ st√≠lusok */
        .grid-point {
            width: 10px;
            height: 10px;
            background-color: #3b82f6; /* K√©k pontok (alap) */
            border-radius: 50%;
            cursor: pointer;
            position: absolute;
            transform: translate(-50%, -50%); /* K√∂zpontos√≠t√°s a koordin√°t√°n */
            transition: all 0.1s;
            z-index: 10;
        }

        .grid-point:hover {
            background-color: #ef4444; /* Piros hover */
            transform: translate(-50%, -50%) scale(1.5);
            box-shadow: 0 0 8px rgba(255, 0, 0, 0.5);
        }

        /* Tippelt pontok (z√∂ld) */
        .guessed-point {
            background-color: #10b981 !important; /* Z√∂ld, ha tippelt */
            opacity: 0.8;
            box-shadow: 0 0 5px rgba(16, 185, 129, 0.8);
            z-index: 20;
            pointer-events: none; /* Ne lehessen √∫jra tippelni */
        }
        
        /* Jel√∂lt pontok (s√°rga) */
        .marked-point {
            background-color: #fcd34d !important; /* S√°rga jel√∂l√©s */
            opacity: 1 !important;
            box-shadow: 0 0 10px #fcd34d !important;
            border: 2px solid #b45309;
            width: 12px;
            height: 12px;
            z-index: 40;
        }

        .distance-label {
            position: absolute;
            font-size: 10px;
            font-weight: bold;
            color: #10b981;
            transform: translate(10px, -15px);
            pointer-events: none;
            z-index: 30;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 1px 3px;
            border-radius: 3px;
            border: 1px solid #10b981;
        }

        .grid-container {
            position: relative;
            /* V√°ltoztat√°s: 90%-r√≥l 100%-ra a jobb illeszked√©s √©rdek√©ben */
            width: 100%; 
            max-width: 600px;
            aspect-ratio: 1 / 1;
            margin: auto;
            border: 2px solid #374151;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
            
            /* V√≠zszintes √©s f√ºgg≈ëleges r√°csvonalak hozz√°ad√°sa CSS gradienttel */
            background-color: white; 
            --line-color: #e5e7eb; 
            --line-width: 1px;
            --grid-spacing: calc(100% / 12);
            
            background-image: 
                /* V√≠zszintes vonalak (Y) */
                linear-gradient(to top, var(--line-color) var(--line-width), transparent var(--line-width)),
                /* F√ºgg≈ëleges vonalak (X) */
                linear-gradient(to right, var(--line-color) var(--line-width), transparent var(--line-width));
                
            background-size: var(--grid-spacing) var(--grid-spacing); 
        }

        .win-message {
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.9; }
        }
        
        /* M√≥dv√°laszt√≥ gombok st√≠lusa */
        .mode-button {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.2s;
            cursor: pointer;
            flex-grow: 1;
            text-align: center;
        }
        .mode-button-active {
            background-color: #3b82f6; /* K√©k */
            color: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
        .mode-button-inactive {
            background-color: #e5e7eb; /* Vil√°gossz√ºrke */
            color: #4b5563;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen p-4 sm:p-8 font-sans">

    <!-- main content is hidden until correct password is entered -->
    <div id="main" style="display:none" aria-hidden="true">
        <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 text-center mb-6 flex justify-center items-center gap-3">
            üíé Kincskeres≈ë J√°t√©k üíé
            <button onclick="openUsageModal()" class="px-3 py-1 bg-gray-200 text-gray-700 text-sm font-semibold rounded-full hover:bg-gray-300 transition duration-200 shadow">
                Haszn√°lat
            </button>
        </h1>
        <p class="text-center text-gray-600 mb-8">
            Kattints egy r√°cspontra a tippel√©shez vagy a r√°cspont sz√≠nez√©s√©hez!
        </p>

        <div class="flex flex-col lg:flex-row gap-8">
            
            <!-- J√ÅT√âKT√âR --><div id="game-area" class="w-full lg:w-3/5">
                
                <!-- M√ìDV√ÅLASZT√ì GOMBOK --><div class="flex gap-4 mb-4">
                    <button id="guess-mode-button" class="mode-button mode-button-active" onclick="setMode('guess')">
                        üéØ Tippel√©s (T√°vols√°g sz√°m√≠t√°s)
                    </button>
                    <button id="mark-mode-button" class="mode-button mode-button-inactive" onclick="setMode('mark')">
                        üìù Jel√∂l√©s (Pont sz√≠nez√©se)
                    </button>
                </div>

                <div class="grid-container bg-white">
                    <!-- A r√°csvonalakat mostant√≥l a grid-container h√°tt√©rk√©pe (CSS gradient) rajzolja. --></div>
                
                <div id="message-box" class="mt-4 p-4 rounded-lg bg-indigo-100 text-indigo-800 font-semibold shadow-inner text-center">
                    Kezdj√ºk! V√°lassz egy pontot a kattint√°ssal!
                </div>
            </div>

            <!-- TIPPEL√âS T√ñRT√âNETE --><div class="w-full lg:w-2/5 p-6 bg-white rounded-xl shadow-lg h-fit">
                <h2 class="text-xl font-semibold text-gray-700 mb-4 border-b pb-2">K√≠s√©rletek T√∂rt√©nete</h2>
                <ul id="history-list" class="space-y-2 text-gray-600">
                    <li class="text-sm italic">M√©g nem volt tipp.</li>
                </ul>
                <div class="mt-6 pt-4 border-t">
                    <button onclick="resetGame()" class="w-full py-2 px-4 bg-red-500 hover:bg-red-600 text-white font-bold rounded-lg transition duration-200 shadow-md">
                        √öj J√°t√©k Kezd√©se
                    </button>
                </div>
            </div>

        </div>
    </div>
    
    <!-- USAGE MODAL -->
    <div id="usage-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4" onclick="closeUsageModal()">
        <div class="bg-white p-8 rounded-xl shadow-2xl max-w-lg w-full transform transition-all duration-300 scale-95" onclick="event.stopPropagation()">
            <h2 class="text-2xl font-bold text-gray-800 border-b pb-2 mb-4 flex justify-between items-center">
                J√°t√©k Haszn√°lata
                <button onclick="closeUsageModal()" class="text-gray-400 hover:text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </h2>
            <ul class="space-y-4 text-gray-700">
                <li>
                    <span class="font-bold text-blue-600">1. A J√°t√©k C√©lja:</span> Tal√°ld meg az elrejtett kincset!
                </li>
                <li>
                    <span class="font-bold text-blue-600">2. M√≥dv√°laszt√°s:</span> K√©t interakci√≥s m√≥d k√∂z√ºl v√°laszthatsz:
                    <ul class="list-disc list-inside ml-4 mt-1 space-y-1">
                        <li><span class="font-bold">üéØ Tippel√©s (Alap√©rtelmezett):</span> Kattints egy r√°cspontra. A rendszer kijelzi, milyen messze van a kincs. A t√°vols√°got <span class="font-bold">a r√°cs vonalai ment√©n haladva sz√°m√≠tja ki</span> (v√≠zszintes l√©p√©sek + f√ºgg≈ëleges l√©p√©sek √∂sszege).</li>
                        <li><span class="font-bold">üìù Jel√∂l√©s:</span> Kattints egy nem tippelt pontra, hogy s√°rg√°val megjel√∂ld vagy t√∂r√∂ld a jel√∂l√©st. Ez a funkci√≥ seg√≠t kiz√°rni a lehet≈ës√©geket an√©lk√ºl, hogy tippet fogyasztan√°l.</li>
                    </ul>
                </li>
                <li>
                    <span class="font-bold text-blue-600">3. √öj J√°t√©k:</span> Az "√öj J√°t√©k Kezd√©se" gombbal √∫j kincs rejt≈ëzik el, √©s a t√°bla t√∂rl≈ëdik.
                </li>
            </ul>
            <button onclick="closeUsageModal()" class="mt-6 w-full py-2 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg transition shadow">
                √ârtem
            </button>
        </div>
    </div>

    <script>
        /* ---------- PASSWORD PROTECTION (client-side, hash-based) ---------- */
        // IMPORTANT: Replace the value of STORED_HASH with the SHA-256 hex hash of your chosen password.
        // To generate a hash for your password, open the page in the browser, open DevTools Console and run:
        //   generateHash('your-password').then(console.log)
        // Then copy the printed hex value here (replace 'CHANGE_ME') and reload the page.
        const STORED_HASH = '8dbb357af3049658779151484d1b5d5e5a899da06aeeff56dd09b7d90909bc09';
        
        // Limit of attempts before blocking interaction (client-side only)
        const MAX_ATTEMPTS = 5;

        // Utility: compute SHA-256 hex of a string
        async function sha256Hex(str) {
            const enc = new TextEncoder();
            const data = enc.encode(str);
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        // Helper exposed for quick hash generation in console:
        // generateHash('mypassword').then(console.log)
        // window.generateHash = sha256Hex;

        // Create a full-page overlay that blocks access until correct password is entered
        function createLockOverlay() {
            const overlay = document.createElement('div');
            overlay.id = 'pw-overlay';
            Object.assign(overlay.style, {
                position: 'fixed',
                inset: '0',
                background: 'rgba(0,0,0,0.75)',
                color: '#fff',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                zIndex: '9999',
                padding: '20px',
                textAlign: 'center'
            });

            const box = document.createElement('div');
            Object.assign(box.style, {
                background: '#111827',
                padding: '24px',
                borderRadius: '12px',
                maxWidth: '480px',
                width: '100%',
                boxShadow: '0 10px 30px rgba(0,0,0,0.5)'
            });

            box.innerHTML = `
                <h2 style="margin:0 0 8px;font-size:20px;font-weight:700;">Jelsz√≥ v√©delem</h2>
                <p style="margin:0 0 12px;color:#d1d5db;">Add meg a jelsz√≥t a tartalom megtekint√©s√©hez.</p>
                <div style="display:flex;gap:8px;justify-content:center;">
                    <input id="pw-input" type="password" placeholder="Jelsz√≥" style="flex:1;padding:10px;border-radius:8px;border:1px solid #374151;background:#0b1220;color:#fff;" />
                    <button id="pw-submit" style="padding:10px 14px;border-radius:8px;background:#3b82f6;border:none;color:#fff;font-weight:600;cursor:pointer;">Bel√©p√©s</button>
                </div>
                <p id="pw-msg" style="color:#fca5a5;margin-top:10px;min-height:18px;font-size:13px;"></p>
            `;

            overlay.appendChild(box);
            document.body.appendChild(overlay);

            return overlay;
        }

        async function authenticate() {
            const main = document.getElementById('main');

            // If STORED_HASH hasn't been set by the developer, block with an instruction
            if (!STORED_HASH || STORED_HASH === 'CHANGE_ME') {
                const overlay = createLockOverlay();
                const msg = overlay.querySelector('#pw-msg');
                msg.textContent = 'A STORED_HASH nincs be√°ll√≠tva a forr√°sban.';
                return; // no further action until developer sets the hash
            }

            const overlay = createLockOverlay();
            const input = overlay.querySelector('#pw-input');
            const submit = overlay.querySelector('#pw-submit');
            const msg = overlay.querySelector('#pw-msg');

            // keep main hidden/inert while locked
            if (main) {
                main.style.display = 'none';
                main.setAttribute('aria-hidden', 'true');
            }

            let attempts = 0;
            function lockOut() {
                msg.textContent = 'T√∫l sok sikertelen pr√≥b√°lkoz√°s. A hozz√°f√©r√©s ideiglenesen letiltva.';
                input.disabled = true;
                submit.disabled = true;
            }

            async function tryPassword() {
                const value = input.value ?? '';
                if (!value) {
                    msg.textContent = 'Adj meg egy jelsz√≥t.';
                    return;
                }
                attempts++;
                submit.disabled = true;
                msg.textContent = 'Ellen≈ërz√©s...';

                try {
                    const h = await sha256Hex(value);
                    if (h === STORED_HASH) {
                        // Success: remove overlay, reveal content and start the game
                        overlay.remove();
                        if (main) {
                            main.style.display = ''; // restore original display
                            main.removeAttribute('aria-hidden');
                        }
                        resetGame();
                        return;
                    } else {
                        msg.textContent = `Hib√°s jelsz√≥. Pr√≥b√°lkoz√°sok: ${attempts}/${MAX_ATTEMPTS}`;
                    }
                } catch (err) {
                    console.error(err);
                    msg.textContent = 'Hiba t√∂rt√©nt a jelsz√≥ ellen≈ërz√©se k√∂zben.';
                } finally {
                    submit.disabled = false;
                    if (attempts >= MAX_ATTEMPTS) lockOut();
                }
            }

            submit.addEventListener('click', tryPassword);
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') tryPassword();
            });

            // Focus input automatically
            input.focus();
            resetGame();
        }
        /* ---------- end password protection ---------- */
        

        // --- J√ÅT√âK LOGIKA ---

        // Konfigur√°ci√≥
        const GRID_SIZE = 12; // R√°cs m√©rete (0-t√≥l 12-ig, 13 vonal)
        const GRID_POINTS_COUNT = GRID_SIZE + 1; // 13

        // Rejtett kincs koordin√°t√°i
        let TREASURE_X;
        let TREASURE_Y;
        let isGameOver = false;
        
        // J√°t√©km√≥d
        let currentMode = 'guess'; // 'guess' (tippel√©s) vagy 'mark' (jel√∂l√©s)

        // Vizu√°lis elemek
        const gridContainer = document.querySelector('.grid-container');
        const historyList = document.getElementById('history-list');
        const messageBox = document.getElementById('message-box');
        const guessModeButton = document.getElementById('guess-mode-button');
        const markModeButton = document.getElementById('mark-mode-button');
        const usageModal = document.getElementById('usage-modal');


        /**
         * Megnyitja a haszn√°lati √∫tmutat√≥ mod√°lis ablakot.
         */
        function openUsageModal() {
            usageModal.classList.remove('hidden');
        }

        /**
         * Bez√°rja a haszn√°lati √∫tmutat√≥ mod√°lis ablakot.
         */
        function closeUsageModal() {
            usageModal.classList.add('hidden');
        }


        /**
         * Be√°ll√≠tja a j√°t√©km√≥dot √©s friss√≠ti a gombokat.
         */
        function setMode(mode) {
            if (isGameOver) return;
            currentMode = mode;
            
            if (mode === 'guess') {
                guessModeButton.classList.add('mode-button-active');
                guessModeButton.classList.remove('mode-button-inactive');
                markModeButton.classList.remove('mode-button-active');
                markModeButton.classList.add('mode-button-inactive');
                messageBox.textContent = 'M√≥d: Tippel√©s. V√°lassz egy pontot a t√°vols√°g kisz√°m√≠t√°s√°hoz.';
            } else {
                markModeButton.classList.add('mode-button-active');
                markModeButton.classList.remove('mode-button-inactive');
                guessModeButton.classList.remove('mode-button-active');
                guessModeButton.classList.add('mode-button-inactive');
                messageBox.textContent = 'M√≥d: Jel√∂l√©s. Kattints egy nem tippelt pontra a sz√≠nez√©shez/t√∂rl√©shez.';
            }
        }

        /**
         * Kisz√°m√≠tja a Manhattan (Taxi Geometria) t√°vols√°got.
         */
        function calculateManhattanDistance(x1, y1, x2, y2) {
            return Math.abs(x1 - x2) + Math.abs(y2 - y1);
        }

        /**
         * R√°cspont gener√°l√°sa
         */
        function createGridPoint(x, y) {
            const point = document.createElement('div');
            point.className = 'grid-point';
            point.style.left = `${(x / GRID_SIZE) * 100}%`;
            point.style.top = `${((GRID_SIZE - y) / GRID_SIZE) * 100}%`; // Y tengely fel√ºlr≈ël lefel√© n≈ë
            point.setAttribute('data-x', x);
            point.setAttribute('data-y', y);
            point.onclick = () => handleClick(x, y, point);
            gridContainer.appendChild(point);
        }

        /**
         * F≈ë kattint√°skezel≈ë, amely kezeli a m√≥dok k√∂z√∂tti v√°lt√°st.
         */
        function handleClick(x, y, pointElement) {
            if (isGameOver) {
                messageBox.textContent = `A j√°t√©k v√©get √©rt! A kincs helye: (${TREASURE_X}, ${TREASURE_Y})`;
                return;
            }

            if (currentMode === 'guess') {
                handleGuessLogic(x, y, pointElement);
            } else if (currentMode === 'mark') {
                toggleMarking(pointElement);
            }
        }
        
        /**
         * Kezeli a Tippel√©s (Guess) m√≥dot.
         */
        function handleGuessLogic(x, y, pointElement) {
            if (pointElement.classList.contains('guessed-point')) {
                messageBox.textContent = `Ezt a pontot (${x}, ${y}) m√°r tippelted. Pr√≥b√°lj m√°sik pontot!`;
                return;
            }

            const distance = calculateManhattanDistance(TREASURE_X, TREASURE_Y, x, y);

            // T√∂rt√©net friss√≠t√©se
            const historyItem = document.createElement('li');
            historyItem.className = 'p-2 bg-gray-50 border border-gray-200 rounded-md flex justify-between items-center';
            // Jav√≠t√°s: A Markdown form√°z√°st (**) lecser√©lj√ºk HTML form√°z√°sra a szintaktikai hiba elker√ºl√©se √©rdek√©ben
            historyItem.innerHTML = `
                <span>Tipp: <span class="font-bold">(${x}, ${y})</span></span>
                <span class="${distance === 0 ? 'text-green-600 font-extrabold text-lg' : 'text-indigo-600 font-bold'}">
                    T√°vols√°g: ${distance}
                </span>
            `;
            if (historyList.querySelector('.italic')) {
                historyList.innerHTML = '';
            }
            historyList.prepend(historyItem);

            // Vizu√°lis friss√≠t√©s a r√°cson
            pointElement.classList.add('guessed-point');
            pointElement.classList.remove('marked-point'); // Elt√°vol√≠tja a jel√∂l√©st, ha volt

            const distanceLabel = document.createElement('span');
            distanceLabel.className = 'distance-label';
            distanceLabel.textContent = distance;
            pointElement.appendChild(distanceLabel);

            // Nyert√©l?
            if (distance === 0) {
                isGameOver = true;
                pointElement.classList.remove('guessed-point');
                pointElement.classList.remove('grid-point');
                pointElement.classList.add('treasure-found'); // √öj oszt√°ly a kincs jel√∂l√©s√©re
                pointElement.style.backgroundColor = '#f59e0b'; // Arany sz√≠n
                pointElement.style.width = '20px';
                pointElement.style.height = '20px';
                pointElement.style.zIndex = '50';
                pointElement.style.boxShadow = '0 0 20px #f59e0b';
                
                messageBox.classList.remove('bg-indigo-100', 'text-indigo-800');
                messageBox.classList.add('bg-green-600', 'text-white', 'win-message');
                // Jav√≠t√°s: A Markdown form√°z√°st (**) lecser√©lj√ºk HTML form√°z√°sra a szintaktikai hiba elker√ºl√©se √©rdek√©ben
                messageBox.innerHTML = `
                    üéâ GRATUL√ÅLOK! Megtal√°ltad a kincset a <span class="font-bold">(${x}, ${y})</span> ponton! 
                    <br>
                    ${historyList.children.length} k√≠s√©rletb≈ël siker√ºlt!
                `;
            } else {
                messageBox.textContent = `A (${x}, ${y}) pont t√°vols√°ga: ${distance} egys√©g. Tippelj tov√°bb!`;
            }
        }
        
        /**
         * Kezeli a Jel√∂l√©s (Mark) m√≥dot.
         */
        function toggleMarking(pointElement) {
            // A m√°r tippelt vagy megtal√°lt pontokat nem jel√∂lhetj√ºk/jel√∂l√©s√ºket nem t√∂r√∂lhetj√ºk
            if (pointElement.classList.contains('guessed-point') || pointElement.classList.contains('treasure-found')) {
                messageBox.textContent = `A m√°r tippelt pontot (${pointElement.getAttribute('data-x')}, ${pointElement.getAttribute('data-y')}) nem lehet jel√∂lni.`;
                return;
            }
            
            if (pointElement.classList.toggle('marked-point')) {
                messageBox.textContent = `A (${pointElement.getAttribute('data-x')}, ${pointElement.getAttribute('data-y')}) pont jel√∂lve lett (s√°rga).`;
            } else {
                messageBox.textContent = `A (${pointElement.getAttribute('data-x')}, ${pointElement.getAttribute('data-y')}) pont jel√∂l√©se t√∂r√∂lve lett.`;
            }
        }

        /**
         * J√°t√©k alaphelyzetbe √°ll√≠t√°sa
         */
        function resetGame() {
            // V√©letlenszer≈± kincs elhelyez√©se
            TREASURE_X = Math.floor(Math.random() * GRID_POINTS_COUNT); // 0-12
            TREASURE_Y = Math.floor(Math.random() * GRID_POINTS_COUNT); // 0-12

            isGameOver = false;
            
            // Vissza√°ll√≠t√°s Tippel√©s m√≥dra
            setMode('guess');

            // J√°t√©kt√©r tiszt√≠t√°sa
            const existingPoints = gridContainer.querySelectorAll('.grid-point, .guessed-point, .treasure-found');
            existingPoints.forEach(p => p.remove());

            // T√∂rt√©net tiszt√≠t√°sa
            historyList.innerHTML = '<li class="text-sm italic">M√©g nem volt tipp.</li>';

            // √úzenet alaphelyzetbe √°ll√≠t√°sa
            messageBox.classList.remove('bg-green-600', 'text-white', 'win-message');
            messageBox.classList.add('bg-indigo-100', 'text-indigo-800');
            
            // M√ìDOS√çTVA: Hozz√°adva a sz√≥k√∂z az "√∫j kincs" k√∂z√©.
            messageBox.textContent = 'Elrejtettem egy √∫j kincset, kezdj el tippelni!';

            // √öj r√°cspontok gener√°l√°sa
            for (let x = 0; x < GRID_POINTS_COUNT; x++) {
                for (let y = 0; y < GRID_POINTS_COUNT; y++) {
                    createGridPoint(x, y);
                }
            }

            console.log(`[Rejtett kincs] √öj helysz√≠n: (${TREASURE_X}, ${TREASURE_Y})`);
        }

        // Els≈ë ind√≠t√°s
        window.onload = authenticate;
    </script>
</body>
</html>
